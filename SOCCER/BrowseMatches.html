<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Browse Matches</title>
  <link rel="stylesheet" href="BrowseMatches.css" />
</head>
<body>
  <a href="GuestHomePage.html" class="back-link">&larr; Home Page</a>

  <main class="container">
    <h1>Browse Match Results</h1>

    <label for="tournamentSelect">Select Tournament:</label>
    <select id="tournamentSelect">
      <option value="">-- Select a Tournament --</option>
    </select>

    <table id="matchesTable" class="matches-table">
      <thead>
        <tr>
          <th>Match</th>
          <th>Date</th>
          <th>Details</th>
        </tr>
      </thead>
      <tbody>
        <!-- Match rows will be added here -->
      </tbody>
    </table>
  </main>

  <script>
    window.addEventListener("DOMContentLoaded", async () => {
      const select = document.getElementById("tournamentSelect");
      const tableBody = document.querySelector("#matchesTable tbody");

      // Fetch tournaments for dropdown
      try {
        const tournamentsRes = await fetch("http://localhost:3000/api/tournaments");
        const tournaments = await tournamentsRes.json();

        tournaments.forEach((t) => {
          const opt = document.createElement("option");
          opt.value = t.tr_id;
          opt.textContent = t.tr_name;
          select.appendChild(opt);
        });
      } catch (err) {
        alert("Failed to load tournaments.");
        return;
      }

      // When a tournament is selected
      select.addEventListener("change", async (e) => {
        const tr_id = e.target.value;
        tableBody.innerHTML = "";
        if (!tr_id) return;

        try {
          const response = await fetch(`http://localhost:3000/api/matches?tournament_id=${tr_id}`);
          const matches = await response.json();

          matches.sort((a, b) => new Date(a.match_date) - new Date(b.match_date));

          matches.forEach((m) => {
            const row = document.createElement("tr");
            row.innerHTML = `
              <td>${m.team1} ${m.goal_score} - ${m.penalty_score} ${m.team2}</td>
              <td>${new Date(m.match_date).toLocaleDateString()}</td>
              <td><a href="matchResultsDetails.html?match_no=${m.match_no}" class="details-btn">All Details</a></td>
            `;
            tableBody.appendChild(row);
          });
        } catch (err) {
          alert("Failed to load match results.");
        }
      });
    });
  </script>
</body>
</html>
